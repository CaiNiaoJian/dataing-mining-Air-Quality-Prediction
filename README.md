# 空气质量数据挖掘项目

## 项目结构
```
.
├── README.md                # 项目说明文档
├── requirements.txt         # 项目依赖包
├── main.py                 # 主程序
├── data_preprocessing.py    # 数据预处理模块
├── exploratory_analysis.py  # 数据探索性分析模块
├── model_building.py        # 模型构建与评估模块
├── models/                 # 模型保存目录
│   ├── Linear_model.pkl    # 线性回归模型
│   ├── Ridge_model.pkl     # Ridge回归模型
│   ├── Lasso_model.pkl     # Lasso回归模型
│   └── ...                # 其他模型文件
├── images/                 # 可视化结果存储目录
│   ├── preprocessing/      # 预处理阶段的可视化结果
│   ├── eda/               # 探索性分析的可视化结果
│   └── models/            # 模型评估的可视化结果
├── trainOX.csv             # 原始训练数据集
├── train.csv               # 预处理后的训练数据集
└── test_noLabelOX.csv      # 测试数据集
```

## 环境配��
- Python 3.x
- 主要依赖包：
  - numpy==1.26.3
  - pandas==2.1.1
  - matplotlib==3.8.2
  - seaborn==0.13.2
  - scikit-learn==1.3.2

## 数据集说明
### 训练集 (trainOX.csv)
- 数据量：35746条记录
- 时间范围：2010-01-02到2014-12-25
- 采样频率：每小时一次
- 字段说明：
  - ID：记录的唯一标识
  - DEWP：露点温度（摄氏度）
  - Ir：累计降雨时长（小时）
  - Is：累计降雪时长（小时）
  - Iws：风速（m/s）
  - PRES：气压（hPa）
  - TEMP：温度（摄氏度）
  - cbwd_NE/NW/SE/cv：风向独热编码
  - date：日期（YYYY-MM-DD）
  - hour：小时（0-23）
  - Label：目标变量，空气质量指数（AQI）

### 测试集 (test_noLabelOX.csv)
- 时间范围：2010-01-07到2014-12-25
- 结构与训练集相同，但不包含Label字段

### 预处理后的数据集 (train.csv)
- 删除了缺失值
- 新增特征：
  - datetime：合并date和hour的时间戳
  - year：年份
  - month：月份
  - day：日期
  - dayofweek：星期几（0-6）
  - is_weekend：是否为周末（0/1）
- 保留原有特征：
  - ID, DEWP, Ir, Is, Iws, PRES, TEMP
  - cbwd_NE, cbwd_NW, cbwd_SE, cbwd_cv
  - Label

## 数据分析流程
### 1. 数据预处理
1. 数据加载和基本信息统计
   - 读取训练集和测试集
   - 生成数据基本统计信息
   - 可视化特征分布

2. 缺失值处理
   - 检测缺失值
   - 生成缺失值分布热力图
   - 删除最后一行不完整数据

3. 时间特征处理
   - 合并date和hour为datetime类型
   - 提取年、月、日、星期几等特征
   - 添加是否周末标记

4. 风向特征验证
   - 验证独热编码的正确性
   - 确保每条记录只有一个风向为1

5. 异常值检测
   - 使用���线图检测异常值
   - 计算各特征的异常值数量
   - 生成异常值分布图

### 2. 数据探索性分析 (EDA)
1. 描述性统计分析
   - 计算数值型特征的基本统计量
   - 生成描述性统计报告
   - 绘制数值特征箱线图

2. 相关性分析
   - 计算特征间的相关系数
   - 生成相关性热力图
   - 识别与目标变量相关性最强的特征

3. 时间序列分析
   - 绘制AQI时间序列趋势图
   - 分析AQI的月度变化模式
   - 分析AQI的日内变化规律

4. 特征分布分析
   - 绘制数值特征的分布直方图
   - 添加核密度估计曲线
   - 生成目标变量的Q-Q图

### 3. 模型构建与评估
1. 数据准备
   - 特征选择：基于EDA结果选择有效特征
   - 数据集划分：80%训练集，20%测试集
   - 特征标准化：使用StandardScaler

2. 模型构建
   - 线性回归模型
     * 基本线性回归
     * Ridge回归（L2正则化）
     * Lasso回归（L1正则化）
     * ElasticNet回归（L1+L2正则化）
   - 集成学习模型
     * 随机森林回归
     * 梯度提升回归
   - 支持向量回归
     * 使用RBF核函数

3. 模型评估
   - 评估指标
     * 均方误差（MSE）
     * 均方根误差（RMSE）
     * 平均绝对误差（MAE）
     * R平方值（R²）
   - 交叉验证
     * 5折交叉验证
     * R²得分的均值和标准差

4. 特征重要性分析
   - 使用随机森林的特征重要性
   - 可视化特征重要性排序

## 数据分析结果

### 1. 描述性统计分析
根据 `descriptive_statistics.csv` 的结果：

#### 数值特征统计
- DEWP（露点温度）：范围从-24.4°C到28.5°C，平均值7.5°C
- TEMP（温度）：范围从-12.0°C到42.5°C，平均值14.4°C
- PRES（气压）：范围从987.2hPa到1046.0hPa，平均值1016.5hPa
- Iws（风速）：范围从0.0m/s到12.3m/s，平均值1.7m/s
- Is（累计降雪时长）：范围从0.0到1.4小时，大部分时间无降雪
- Ir（累计降雨时长）：范围从0.0到0.5小时，降雨分布较为集中

#### 箱线图分析 (boxplot.png)
- 所有数值特征都存在异常值
- TEMP和DEWP的分布相对对称
- Ir和Is的分布高度偏斜，大部分值集中在较低范围
- PRES的分布较为集中，异常值较少

### 2. 相关性分析 (correlation_heatmap.png)

#### 与目标变量(Label)的主要相关性
1. 正相关：
   - DEWP (0.56): 露点温度与AQI呈中等正相关
   - TEMP (0.32): 温度与AQI呈弱正相关
   - month (0.28): 月份与AQI有弱正相关，表明季节性影响

2. 负相关：
   - Iws (-0.31): 风速与AQI呈负相关，表明风速越大，空气质量越好
   - PRES (-0.25): 气压与AQI呈弱负相关

3. 弱相关：
   - 风向特征(cbwd_*)与AQI的相关性较弱
   - 时间特征(hour, day)与AQI几乎无相关性

### 3. 时间序列分析

#### AQI时间序列趋势 (aqi_time_series.png)
- 整体趋势：2010-2014年间AQI呈现波动性变化
- 季节性特征：每年都有明显的周期性波动
- 极值点：存在多个明显的峰值，可能对应特殊天气事件

#### 月度变化 (aqi_monthly_pattern.png)
- 冬季（12-2月）AQI值显著高于其他季节
- 夏季（6-8月）AQI值最低
- 标准差显示冬季的AQI波动性也最大

#### 日内变化 (aqi_hourly_pattern.png)
- 早晚高峰：AQI在早晨和晚上时段较高
- 下午时段（14-16点）AQI相对较低
- 夜间到清晨AQI逐渐累积上升

### 4. 特征分布分析

#### 数值特征分布 (feature_distributions.png)
1. TEMP和DEWP：
   - 近似正态分布
   - 分布较为对称
   - TEMP的范围更广

2. PRES：
   - 近似正态分布
   - 分布集中，波动较小
   - 存在少量异常值

3. Iws：
   - 右偏分布
   - 大部分值集中在低风速区域
   - 长尾分布特征明显

4. Ir和Is：
   - 高度右偏分布
   - 大量观测值为0，表示无降水
   - Ir（降雨）出现频率高于Is（降雪）
   - 降水持续时间普遍较短
   - 降雪主要出现在冬季月份

#### Label分布特征
- Q-Q图(label_qq_plot.png)显示：
  - AQI值呈现右偏分布
  - 中等AQI值区间较符合正态分布
  - 高AQI值区间偏离正态分布明显
  - 存在较多极端值

### 主要发现
1. 季节性影响显著：
   - 冬季空气质量明显差于其他季节
   - 可能与采暖、降雪和气象条件综合作用有关
   - 降雪天气可能加剧污染物累积

2. 气象因素影响：
   - 露点温度是最重要的相关因素
   - 风速对空气质量有明显改善作用
   - 气压变化与空气质量有一定关联
   - 降水（雨雪）对空气质量有短期净化作用
   - 降雪天气可能导致污染物难以扩散

3. 日间变化规律：
   - 早晚高峰现象明显
   - 可能与人类活动（交通、工业）有关

4. 特征分布特点：
   - 大多数气象特征呈现正态或近似正态分布
   - 降水特征（Ir、Is）呈现典型的零膨胀分布
   - 降水事件相对稀少但对空气质量有显著影响
   - AQI值呈现右偏分布，存在较多极端情况

### 建议
1. 模型构建：
   - 考虑对降水特征进行特殊处理（如二值化或分类）
   - 可能需要对异常值进行特殊处理
   - 考虑添加降水与其他气象特征的交互项
   - 可以考虑将降水特征转换为累积量或移动平均

2. 预测策略：
   - 针对不同天气条件（晴天/雨天/雪天）建立独立模型
   - 需要特别关注极端天气条件下的预测
   - 考虑将降水特征作为重要预测因子

3. 实际应用：
   - 重点关注冬季和降雪天气的空气质量管理
   - 可以根据气象预报（特别是降水预报）提前预警
   - 在降雪天气加强污染物排放管控
   - 建议在早晚高峰和特殊天气条件下加强管控

## 可视化结果
### 预处理阶段 (images/preprocessing/)
- numeric_features_distribution.png：数值特征分布图
- wind_direction_distribution.png：风向分布图
- missing_values_heatmap.png：缺失值分布热力图
- outliers_boxplot.png：异常值箱线图

### 探索性分析阶段 (images/eda/)
- descriptive_statistics.csv：描述性统计结果
- boxplot.png：数值特征箱线图
- correlation_heatmap.png：特征相关性热力图
- aqi_time_series.png：AQI时间序列趋势图
- aqi_monthly_pattern.png：AQI月度变化图
- aqi_hourly_pattern.png：AQI日内变化图
- feature_distributions.png：特征分布图
- label_qq_plot.png：目标变量Q-Q图

### 模型评估阶段 (images/models/)
- Linear_model.pkl：线性回归模型
- Ridge_model.pkl：Ridge回归模型
- Lasso_model.pkl：Lasso回归模型
- ...：其他模型文件

## 更新日志
### 2023-12-28
- 初始化项目结构
- 创建虚拟环境
- 配置依赖包
- 创建images目录
- 实现数据预处理模块
  - 完成数据加载和基本统计
  - 实现缺失值检测和可视化
  - 添加时间特征处理
  - 完成风向特征验证
  - 实现异常值检测和可视化
  - 添加预处理数据保存功能
- 实现数据探索性分析模块
  - 完成描述性统计分析
  - 实现相关性分析
  - 添加时间序列分析
  - 完成特征分布分析
  - 生成可视化结果
- 实现模型构建与评估模块
  - 完成数据准备和特征工程
  - 实现多种回归模型
  - 添加模型评估功能
  - 完成特征重要性分析
  - 生成模型评估可视化结果
